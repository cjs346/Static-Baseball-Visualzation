<!DOCTYPE html>
<html>
<head>
	<title>Project 1</title>
	<link rel="stylesheet" href="css/style.css">
	<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
</head>
<body>
	<div id="main">
		<h1>Where do the balls go?</h1>
	</div>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.7.1/d3.js"></script>
	<script type="text/javascript" src="js/pathGenerator.js"></script>
	<script type="text/javascript" src="js/ballpark.js"></script>

	<script type="text/javascript">
		var ballparks;
		var homeruns;

		var parseBallparkRow = function(d) {
			return {
				ballpark: d.ballpark,
				homeTeam: d.hometeam,
				teamName: d.hometeamname,
				lf: +d.leftfield,
				lcf: +d.leftcenterfield,
				cf: +d.centerfield,
				rcf: +d.rightcenterfield,
				rf: +d.rightfield,
				color1: d.hometeamcolor1,
				color2: d.hometeamcolor2
			};
		};

		d3.queue()
			.defer(d3.csv, "csv/ballparks.csv", parseBallparkRow)
			.defer(d3.csv, "csv/all_stadiums.csv")
			.await(function(error, rawBallparks, rawHomeruns) {
				ballparks = rawBallparks;
				homeruns = d3.nest()
										 .key(function(d) { return d.ballpark; })
										 .key(function(d) { return d.season; })
										 .entries(rawHomeruns);

				drawBallparks();
			});

		function drawBallparks() {
			var hrMax = d3.max(homeruns, function(ballparkHrs) {
				return d3.max(ballparkHrs.values, function(season) {
					return season.values.length;
				});
			});

			for (var i = 0; i < ballparks.length; i++) {
				var ballparkHrs = null;
				homeruns.forEach(function(hr) {
					if (hr.key == ballparks[i].ballpark) {
						ballparkHrs = hr.values;
					}
				});

				var svg = d3.select("#main")
					.append("svg")
					.attr("width", 500)
					.attr("height", 700)
					.attr("id", ballparks[i].ballpark);

				svg.append("text")
					.text(ballparks[i].ballpark)
					.attr("font-family", "Open Sans")
					.attr("text-anchor", "left")
					.attr("alignment-baseline", "hanging")
					.attr("x", 24)
					.attr("y", 12)
					.attr("font-weight", "bold")
					.attr("font-size", "32px");
	
				svg.append("text")
					.text(ballparks[i].teamName)
					.attr("font-family", "Open Sans")
					.attr("text-anchor", "left")
					.attr("alignment-baseline", "hanging")
					.attr("x", 24)
					.attr("y", 56)
					.attr("font-size", "18px");

				var park = new Ballpark(svg, {
					lf: ballparks[i].lf,
					lcf: ballparks[i].lcf,
					cf: ballparks[i].cf,
					rcf: ballparks[i].rcf,
					rf: ballparks[i].rf,
				});

				//console.log(ballparkHrs);

				if (!ballparkHrs) continue;
				park.drawHomeRuns(ballparkHrs, ballparks[i]);
				park.drawBarCharts(ballparkHrs, hrMax, ballparks[i]);
			}
		}
	</script>
</body>
</html>
